import{S as ht,i as ut,s as dt,e as At,b as ve,L as pe,h as S,k as R,q as W,a as G,l as x,m as C,r as X,c as V,n as j,E as b,u as Me,F as or,w as Pt,M as Ct,N as Rt,y as tt,O as xt,z as rt,A as st,d as fe,f as Kt,g as ie,P as It,B as it,K as ar,o as lr,Q as cr,v as Wt,R as hr}from"../chunks/index.276b7e77.js";import{w as ft}from"../chunks/index.912cec11.js";import{r as ur,o as dr,d as fr}from"../chunks/firebase.601ba531.js";import{_ as qe}from"../chunks/preload-helper.41c905a7.js";function pr(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}function vr(n){let e,t,r,s,i,o;return{c(){e=R("div"),t=R("span"),r=W(n[0]),s=G(),i=R("span"),o=W("Loading..."),this.h()},l(a){e=x(a,"DIV",{class:!0});var l=C(e);t=x(l,"SPAN",{class:!0});var h=C(t);r=X(h,n[0]),h.forEach(S),s=V(l),i=x(l,"SPAN",{class:!0});var c=C(i);o=X(c,"Loading..."),c.forEach(S),l.forEach(S),this.h()},h(){j(t,"class","title svelte-jnczef"),j(i,"class","value svelte-jnczef"),j(e,"class","container svelte-jnczef")},m(a,l){ve(a,e,l),b(e,t),b(t,r),b(e,s),b(e,i),b(i,o)},p(a,l){l&1&&Me(r,a[0])},d(a){a&&S(e)}}}function _r(n){let e,t,r,s,i,o=n[1].value+"",a,l=n[1].unit+"",h;return{c(){e=R("div"),t=R("span"),r=W(n[0]),s=G(),i=R("span"),a=W(o),h=W(l),this.h()},l(c){e=x(c,"DIV",{class:!0});var d=C(e);t=x(d,"SPAN",{class:!0});var p=C(t);r=X(p,n[0]),p.forEach(S),s=V(d),i=x(d,"SPAN",{class:!0});var v=C(i);a=X(v,o),h=X(v,l),v.forEach(S),d.forEach(S),this.h()},h(){j(t,"class","title svelte-jnczef"),j(i,"class","value svelte-jnczef"),j(e,"class","container svelte-jnczef")},m(c,d){ve(c,e,d),b(e,t),b(t,r),b(e,s),b(e,i),b(i,a),b(i,h)},p(c,d){d&1&&Me(r,c[0]),d&2&&o!==(o=c[1].value+"")&&Me(a,o),d&2&&l!==(l=c[1].unit+"")&&Me(h,l)},d(c){c&&S(e)}}}function mr(n){let e;function t(i,o){return i[1].value!=null?_r:vr}let r=t(n),s=r(n);return{c(){s.c(),e=At()},l(i){s.l(i),e=At()},m(i,o){s.m(i,o),ve(i,e,o)},p(i,[o]){r===(r=t(i))&&s?s.p(i,o):(s.d(1),s=r(i),s&&(s.c(),s.m(e.parentNode,e)))},i:pe,o:pe,d(i){s.d(i),i&&S(e)}}}function gr(n,e,t){let{name:r="CO2"}=e,{value:s={value:0,unit:"ppm"}}=e;return n.$$set=i=>{"name"in i&&t(0,r=i.name),"value"in i&&t(1,s=i.value)},[r,s]}class yr extends ht{constructor(e){super(),ut(this,e,gr,mr,dt,{name:0,value:1})}}function br(n){let e,t,r,s,i,o;return{c(){e=R("label"),t=R("input"),r=G(),s=R("span"),this.h()},l(a){e=x(a,"LABEL",{class:!0});var l=C(e);t=x(l,"INPUT",{type:!0,class:!0}),r=V(l),s=x(l,"SPAN",{class:!0}),C(s).forEach(S),l.forEach(S),this.h()},h(){j(t,"type","checkbox"),j(t,"class","svelte-xb80jm"),j(s,"class","slider round svelte-xb80jm"),j(e,"class","switch svelte-xb80jm")},m(a,l){ve(a,e,l),b(e,t),t.checked=n[0],b(e,r),b(e,s),i||(o=or(t,"change",n[1]),i=!0)},p(a,[l]){l&1&&(t.checked=a[0])},i:pe,o:pe,d(a){a&&S(e),i=!1,o()}}}function wr(n,e,t){let{checked:r}=e;function s(){r=this.checked,t(0,r)}return n.$$set=i=>{"checked"in i&&t(0,r=i.checked)},[r,s]}class Dt extends ht{constructor(e){super(),ut(this,e,wr,br,dt,{checked:0})}}const Tr=ft({}),Er=ur(fr,"data");dr(Er,n=>{Tr.set(n.val())});var kr=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?i(c.value):s(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})};const Or=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>kr(void 0,void 0,void 0,function*(){return yield(yield qe(()=>Promise.resolve().then(()=>He),void 0,import.meta.url)).fetch(...t)}):e=fetch,(...t)=>e(...t)};class pt extends Error{constructor(e,t="FunctionsError",r){super(e),super.name=t,this.context=r}}class Sr extends pt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class jr extends pt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class $r extends pt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Ar=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?i(c.value):s(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})};class Pr{constructor(e,{headers:t={},customFetch:r}={}){this.url=e,this.headers=t,this.fetch=Or(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Ar(this,void 0,void 0,function*(){try{const{headers:s,method:i,body:o}=t;let a={},l;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",l=o):typeof o=="string"?(a["Content-Type"]="text/plain",l=o):typeof FormData<"u"&&o instanceof FormData?l=o:(a["Content-Type"]="application/json",l=JSON.stringify(o)));const h=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:l}).catch(v=>{throw new Sr(v)}),c=h.headers.get("x-relay-error");if(c&&c==="true")throw new jr(h);if(!h.ok)throw new $r(h);let d=((r=h.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),p;return d==="application/json"?p=yield h.json():d==="application/octet-stream"?p=yield h.blob():d==="multipart/form-data"?p=yield h.formData():p=yield h.text(),{data:p,error:null}}catch(s){return{data:null,error:s}}})}}var Cr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Rr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var nt={exports:{}};(function(n,e){var t=typeof self<"u"?self:Cr,r=function(){function i(){this.fetch=!1,this.DOMException=t.DOMException}return i.prototype=t,new i}();(function(i){(function(o){var a={searchParams:"URLSearchParams"in i,iterable:"Symbol"in i&&"iterator"in Symbol,blob:"FileReader"in i&&"Blob"in i&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in i,arrayBuffer:"ArrayBuffer"in i};function l(u){return u&&DataView.prototype.isPrototypeOf(u)}if(a.arrayBuffer)var h=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(u){return u&&h.indexOf(Object.prototype.toString.call(u))>-1};function d(u){if(typeof u!="string"&&(u=String(u)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(u))throw new TypeError("Invalid character in header field name");return u.toLowerCase()}function p(u){return typeof u!="string"&&(u=String(u)),u}function v(u){var f={next:function(){var y=u.shift();return{done:y===void 0,value:y}}};return a.iterable&&(f[Symbol.iterator]=function(){return f}),f}function m(u){this.map={},u instanceof m?u.forEach(function(f,y){this.append(y,f)},this):Array.isArray(u)?u.forEach(function(f){this.append(f[0],f[1])},this):u&&Object.getOwnPropertyNames(u).forEach(function(f){this.append(f,u[f])},this)}m.prototype.append=function(u,f){u=d(u),f=p(f);var y=this.map[u];this.map[u]=y?y+", "+f:f},m.prototype.delete=function(u){delete this.map[d(u)]},m.prototype.get=function(u){return u=d(u),this.has(u)?this.map[u]:null},m.prototype.has=function(u){return this.map.hasOwnProperty(d(u))},m.prototype.set=function(u,f){this.map[d(u)]=p(f)},m.prototype.forEach=function(u,f){for(var y in this.map)this.map.hasOwnProperty(y)&&u.call(f,this.map[y],y,this)},m.prototype.keys=function(){var u=[];return this.forEach(function(f,y){u.push(y)}),v(u)},m.prototype.values=function(){var u=[];return this.forEach(function(f){u.push(f)}),v(u)},m.prototype.entries=function(){var u=[];return this.forEach(function(f,y){u.push([y,f])}),v(u)},a.iterable&&(m.prototype[Symbol.iterator]=m.prototype.entries);function w(u){if(u.bodyUsed)return Promise.reject(new TypeError("Already read"));u.bodyUsed=!0}function _(u){return new Promise(function(f,y){u.onload=function(){f(u.result)},u.onerror=function(){y(u.error)}})}function T(u){var f=new FileReader,y=_(f);return f.readAsArrayBuffer(u),y}function F(u){var f=new FileReader,y=_(f);return f.readAsText(u),y}function I(u){for(var f=new Uint8Array(u),y=new Array(f.length),D=0;D<f.length;D++)y[D]=String.fromCharCode(f[D]);return y.join("")}function A(u){if(u.slice)return u.slice(0);var f=new Uint8Array(u.byteLength);return f.set(new Uint8Array(u)),f.buffer}function H(){return this.bodyUsed=!1,this._initBody=function(u){this._bodyInit=u,u?typeof u=="string"?this._bodyText=u:a.blob&&Blob.prototype.isPrototypeOf(u)?this._bodyBlob=u:a.formData&&FormData.prototype.isPrototypeOf(u)?this._bodyFormData=u:a.searchParams&&URLSearchParams.prototype.isPrototypeOf(u)?this._bodyText=u.toString():a.arrayBuffer&&a.blob&&l(u)?(this._bodyArrayBuffer=A(u.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(u)||c(u))?this._bodyArrayBuffer=A(u):this._bodyText=u=Object.prototype.toString.call(u):this._bodyText="",this.headers.get("content-type")||(typeof u=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):a.searchParams&&URLSearchParams.prototype.isPrototypeOf(u)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a.blob&&(this.blob=function(){var u=w(this);if(u)return u;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?w(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(T)}),this.text=function(){var u=w(this);if(u)return u;if(this._bodyBlob)return F(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(I(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a.formData&&(this.formData=function(){return this.text().then(Ee)}),this.json=function(){return this.text().then(JSON.parse)},this}var we=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Te(u){var f=u.toUpperCase();return we.indexOf(f)>-1?f:u}function N(u,f){f=f||{};var y=f.body;if(u instanceof N){if(u.bodyUsed)throw new TypeError("Already read");this.url=u.url,this.credentials=u.credentials,f.headers||(this.headers=new m(u.headers)),this.method=u.method,this.mode=u.mode,this.signal=u.signal,!y&&u._bodyInit!=null&&(y=u._bodyInit,u.bodyUsed=!0)}else this.url=String(u);if(this.credentials=f.credentials||this.credentials||"same-origin",(f.headers||!this.headers)&&(this.headers=new m(f.headers)),this.method=Te(f.method||this.method||"GET"),this.mode=f.mode||this.mode||null,this.signal=f.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&y)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(y)}N.prototype.clone=function(){return new N(this,{body:this._bodyInit})};function Ee(u){var f=new FormData;return u.trim().split("&").forEach(function(y){if(y){var D=y.split("="),U=D.shift().replace(/\+/g," "),E=D.join("=").replace(/\+/g," ");f.append(decodeURIComponent(U),decodeURIComponent(E))}}),f}function ke(u){var f=new m,y=u.replace(/\r?\n[\t ]+/g," ");return y.split(/\r?\n/).forEach(function(D){var U=D.split(":"),E=U.shift().trim();if(E){var ae=U.join(":").trim();f.append(E,ae)}}),f}H.call(N.prototype);function L(u,f){f||(f={}),this.type="default",this.status=f.status===void 0?200:f.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in f?f.statusText:"OK",this.headers=new m(f.headers),this.url=f.url||"",this._initBody(u)}H.call(L.prototype),L.prototype.clone=function(){return new L(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new m(this.headers),url:this.url})},L.error=function(){var u=new L(null,{status:0,statusText:""});return u.type="error",u};var ne=[301,302,303,307,308];L.redirect=function(u,f){if(ne.indexOf(f)===-1)throw new RangeError("Invalid status code");return new L(null,{status:f,headers:{location:u}})},o.DOMException=i.DOMException;try{new o.DOMException}catch{o.DOMException=function(f,y){this.message=f,this.name=y;var D=Error(f);this.stack=D.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function oe(u,f){return new Promise(function(y,D){var U=new N(u,f);if(U.signal&&U.signal.aborted)return D(new o.DOMException("Aborted","AbortError"));var E=new XMLHttpRequest;function ae(){E.abort()}E.onload=function(){var le={status:E.status,statusText:E.statusText,headers:ke(E.getAllResponseHeaders()||"")};le.url="responseURL"in E?E.responseURL:le.headers.get("X-Request-URL");var me="response"in E?E.response:E.responseText;y(new L(me,le))},E.onerror=function(){D(new TypeError("Network request failed"))},E.ontimeout=function(){D(new TypeError("Network request failed"))},E.onabort=function(){D(new o.DOMException("Aborted","AbortError"))},E.open(U.method,U.url,!0),U.credentials==="include"?E.withCredentials=!0:U.credentials==="omit"&&(E.withCredentials=!1),"responseType"in E&&a.blob&&(E.responseType="blob"),U.headers.forEach(function(le,me){E.setRequestHeader(me,le)}),U.signal&&(U.signal.addEventListener("abort",ae),E.onreadystatechange=function(){E.readyState===4&&U.signal.removeEventListener("abort",ae)}),E.send(typeof U._bodyInit>"u"?null:U._bodyInit)})}return oe.polyfill=!0,i.fetch||(i.fetch=oe,i.Headers=m,i.Request=N,i.Response=L),o.Headers=m,o.Request=N,o.Response=L,o.fetch=oe,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var s=r;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,n.exports=e})(nt,nt.exports);var vt=nt.exports;const _t=Rr(vt),He=pr({__proto__:null,default:_t},[vt]);class xr{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=_t:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,a,l;let h=null,c=null,d=null,p=i.status,v=i.statusText;if(i.ok){if(this.method!=="HEAD"){const T=await i.text();T===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?c=T:c=JSON.parse(T))}const w=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),_=(a=i.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");w&&_&&_.length>1&&(d=parseInt(_[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(c)&&(c.length>1?(h={code:"PGRST116",details:`Results contain ${c.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},c=null,d=null,p=406,v="Not Acceptable"):c.length===1?c=c[0]:c=null)}else{const w=await i.text();try{h=JSON.parse(w),Array.isArray(h)&&i.status===404&&(c=[],h=null,p=200,v="OK")}catch{i.status===404&&w===""?(p=204,v="No Content"):h={message:w}}if(h&&this.isMaybeSingle&&(!((l=h==null?void 0:h.details)===null||l===void 0)&&l.includes("Results contain 0 rows"))&&(h=null,p=200,v="OK"),h&&this.shouldThrowOnError)throw h}return{error:h,data:c,count:d,status:p,statusText:v}});return this.shouldThrowOnError||(s=s.catch(i=>{var o,a,l;return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(a=i==null?void 0:i.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=i==null?void 0:i.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}}class Ir extends xr{select(e){let t=!1;const r=(e??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s}={}){const i=s?`${s}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t}={}){const r=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:r}={}){const s=typeof r>"u"?"offset":`${r}.offset`,i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:i=!1,format:o="text"}={}){const a=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=this.headers.Accept;return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${l}"; options=${a};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class ye extends Ir{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=t.map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let i="";s==="plain"?i="pl":s==="phrase"?i="ph":s==="websearch"&&(i="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t}={}){const r=t?`${t}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}class Dr{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=t,this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let i=!1;const o=(e??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new ye({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const s="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const o=e.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(o.length>0){const a=[...new Set(o)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new ye({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:i=!0}={}){const o="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),i||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const l=e.reduce((h,c)=>h.concat(Object.keys(c)),[]);if(l.length>0){const h=[...new Set(l)].map(c=>`"${c}"`);this.url.searchParams.set("columns",h.join(","))}}return new ye({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new ye({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new ye({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const Ur="1.6.1",Lr={"X-Client-Info":`postgrest-js/${Ur}`};class Fr{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},Lr),t),this.schema=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new Dr(t,{headers:Object.assign({},this.headers),schema:this.schema,fetch:this.fetch})}rpc(e,t={},{head:r=!1,count:s}={}){let i;const o=new URL(`${this.url}/rpc/${e}`);let a;r?(i="HEAD",Object.entries(t).forEach(([h,c])=>{o.searchParams.append(h,`${c}`)})):(i="POST",a=t);const l=Object.assign({},this.headers);return s&&(l.Prefer=`count=${s}`),new ye({method:i,url:o,headers:l,schema:this.schema,body:a,fetch:this.fetch,allowEmpty:!1})}}var Ve,Ut;function Nr(){if(Ut)return Ve;Ut=1;var n=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};return Ve=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return n()}try{return __global__||n()}finally{delete Object.prototype.__global__}}(),Ve}const Br="websocket",Mr="Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",qr=["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],Hr="Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",Jr=["Iñaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],zr="1.0.34",Gr={type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},Vr="https://github.com/theturtle32/WebSocket-Node",Kr={node:">=4.0.0"},Wr={bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},Xr={"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},Qr={verbose:!1},Yr={test:"tape test/unit/*.js",gulp:"gulp"},Zr="index",es={lib:"./lib"},ts="lib/browser.js",rs="Apache-2.0",ss={name:Br,description:Mr,keywords:qr,author:Hr,contributors:Jr,version:zr,repository:Gr,homepage:Vr,engines:Kr,dependencies:Wr,devDependencies:Xr,config:Qr,scripts:Yr,main:Zr,directories:es,browser:ts,license:rs};var is=ss.version,he;if(typeof globalThis=="object")he=globalThis;else try{he=Nr()}catch{}finally{if(!he&&typeof window<"u"&&(he=window),!he)throw new Error("Could not determine global this")}var Ce=he.WebSocket||he.MozWebSocket,ns=is;function Xt(n,e){var t;return e?t=new Ce(n,e):t=new Ce(n),t}Ce&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(n){Object.defineProperty(Xt,n,{get:function(){return Ce[n]}})});var os={w3cwebsocket:Ce?Xt:null,version:ns};const as="2.7.2",ls={"X-Client-Info":`realtime-js/${as}`},cs="1.0.0",Qt=1e4,hs=1e3;var $e;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})($e||($e={}));var J;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(J||(J={}));var K;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(K||(K={}));var ot;(function(n){n.websocket="websocket"})(ot||(ot={}));var ue;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(ue||(ue={}));class Yt{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class us{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+s));o=o+s;const l=r.decode(e.slice(o,o+i));o=o+i;const h=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:l,payload:h}}}class Ke{constructor(e,t,r={},s=Qt){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null,this.rateLimited=!1}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){if(this._hasReceived("timeout"))return;this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()})==="rate limited"&&(this.rateLimited=!0)}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Lt;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Lt||(Lt={}));class Ae{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ae.syncState(this.state,s,i,o),this.pendingDiffs.forEach(l=>{this.state=Ae.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Ae.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const i=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(i,(h,c)=>{o[h]||(l[h]=c)}),this.map(o,(h,c)=>{const d=i[h];if(d){const p=c.map(_=>_.presence_ref),v=d.map(_=>_.presence_ref),m=c.filter(_=>v.indexOf(_.presence_ref)<0),w=d.filter(_=>p.indexOf(_.presence_ref)<0);m.length>0&&(a[h]=m),w.length>0&&(l[h]=w)}else a[h]=c}),this.syncDiff(i,{joins:a,leaves:l},r,s)}static syncDiff(e,t,r,s){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(a,l)=>{var h;const c=(h=e[a])!==null&&h!==void 0?h:[];if(e[a]=this.cloneDeep(l),c.length>0){const d=e[a].map(v=>v.presence_ref),p=c.filter(v=>d.indexOf(v.presence_ref)<0);e[a].unshift(...p)}r(a,c,l)}),this.map(o,(a,l)=>{let h=e[a];if(!h)return;const c=l.map(d=>d.presence_ref);h=h.filter(d=>c.indexOf(d.presence_ref)<0),e[a]=h,s(a,h,l),h.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var $;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})($||($={}));const Ft=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,o)=>(i[o]=ds(o,n,e,s),i),{})},ds=(n,e,t,r)=>{const s=e.find(a=>a.name===n),i=s==null?void 0:s.type,o=t[n];return i&&!r.includes(i)?Zt(i,o):at(o)},Zt=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return _s(e,t)}switch(n){case $.bool:return fs(e);case $.float4:case $.float8:case $.int2:case $.int4:case $.int8:case $.numeric:case $.oid:return ps(e);case $.json:case $.jsonb:return vs(e);case $.timestamp:return ms(e);case $.abstime:case $.date:case $.daterange:case $.int4range:case $.int8range:case $.money:case $.reltime:case $.text:case $.time:case $.timestamptz:case $.timetz:case $.tsrange:case $.tstzrange:return at(e);default:return at(e)}},at=n=>n,fs=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},ps=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},vs=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},_s=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let i;const o=n.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>Zt(e,a))}return n},ms=n=>typeof n=="string"?n.replace(" ","T"):n;var Nt=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?i(c.value):s(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})},Bt;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Bt||(Bt={}));var Mt;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes"})(Mt||(Mt={}));var qt;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(qt||(qt={}));class mt{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=J.closed,this.joinedOnce=!1,this.pushBuffer=[],this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new Ke(this,K.join,this.params,this.timeout),this.rejoinTimer=new Yt(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=J.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=J.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=J.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=J.errored,this.rejoinTimer.scheduleTimeout())}),this._on(K.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new Ae(this)}subscribe(e,t=this.timeout){var r,s;if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:o}}=this.params;this._onError(h=>e&&e("CHANNEL_ERROR",h)),this._onClose(()=>e&&e("CLOSED"));const a={},l={broadcast:i,presence:o,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(h=>h.filter))!==null&&s!==void 0?s:[]};this.socket.accessToken&&(a.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:l},a)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:h})=>{var c;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),h===void 0){e&&e("SUBSCRIBED");return}else{const d=this.bindings.postgres_changes,p=(c=d==null?void 0:d.length)!==null&&c!==void 0?c:0,v=[];for(let m=0;m<p;m++){const w=d[m],{filter:{event:_,schema:T,table:F,filter:I}}=w,A=h&&h[m];if(A&&A.event===_&&A.schema===T&&A.table===F&&A.filter===I)v.push(Object.assign(Object.assign({},w),{id:A.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,e&&e("SUBSCRIBED");return}}).receive("error",h=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(h).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}track(e,t={}){return Nt(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(e={}){return Nt(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,r){return this._on(e,t,r)}send(e,t={}){return new Promise(r=>{var s,i,o;const a=this._push(e.type,e,t.timeout||this.timeout);a.rateLimited&&r("rate limited"),e.type==="broadcast"&&!(!((o=(i=(s=this.params)===null||s===void 0?void 0:s.config)===null||i===void 0?void 0:i.broadcast)===null||o===void 0)&&o.ack)&&r("ok"),a.receive("ok",()=>r("ok")),a.receive("timeout",()=>r("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=J.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(K.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const s=new Ke(this,K.leave,{},e);s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Ke(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:h,join:c}=K;if(r&&[a,l,h,c].indexOf(o)>=0&&r!==this._joinRef())return;let p=this._onMessage(o,t,r);if(t&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(v=>{var m,w,_;return((m=v.filter)===null||m===void 0?void 0:m.event)==="*"||((_=(w=v.filter)===null||w===void 0?void 0:w.event)===null||_===void 0?void 0:_.toLocaleLowerCase())===o}).map(v=>v.callback(p,r)):(i=this.bindings[o])===null||i===void 0||i.filter(v=>{var m,w,_,T,F,I;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in v){const A=v.id,H=(m=v.filter)===null||m===void 0?void 0:m.event;return A&&((w=t.ids)===null||w===void 0?void 0:w.includes(A))&&(H==="*"||(H==null?void 0:H.toLocaleLowerCase())===((_=t.data)===null||_===void 0?void 0:_.type.toLocaleLowerCase()))}else{const A=(F=(T=v==null?void 0:v.filter)===null||T===void 0?void 0:T.event)===null||F===void 0?void 0:F.toLocaleLowerCase();return A==="*"||A===((I=t==null?void 0:t.event)===null||I===void 0?void 0:I.toLocaleLowerCase())}else return v.type.toLocaleLowerCase()===o}).map(v=>{if(typeof p=="object"&&"ids"in p){const m=p.data,{schema:w,table:_,commit_timestamp:T,type:F,errors:I}=m;p=Object.assign(Object.assign({},{schema:w,table:_,commit_timestamp:T,eventType:F,new:{},old:{},errors:I}),this._getPayloadRecords(m))}v.callback(p,r)})}_isClosed(){return this.state===J.closed}_isJoined(){return this.state===J.joined}_isJoining(){return this.state===J.joining}_isLeaving(){return this.state===J.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&mt.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(K.close,{},e)}_onError(e){this._on(K.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=J.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Ft(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Ft(e.columns,e.old_record)),t}}var We=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?i(c.value):s(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})};const gs=()=>{};class ys{constructor(e,t){var r;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=ls,this.params={},this.timeout=Qt,this.transport=os.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=gs,this.conn=null,this.sendBuffer=[],this.serializer=new us,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.eventsPerSecondLimitMs=100,this.inThrottle=!1,this.endPoint=`${e}/${ot.websocket}`,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.transport&&(this.transport=t.transport),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.eventsPerSecond;s&&(this.eventsPerSecondLimitMs=Math.floor(1e3/s)),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Yt(()=>We(this,void 0,void 0,function*(){this.disconnect(),this.connect()}),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this._endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e)))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}removeChannel(e){return We(this,void 0,void 0,function*(){const t=yield e.unsubscribe();return this.channels.length===0&&this.disconnect(),t})}removeAllChannels(){return We(this,void 0,void 0,function*(){const e=yield Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e})}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case $e.connecting:return ue.Connecting;case $e.open:return ue.Open;case $e.closing:return ue.Closing;default:return ue.Closed}}isConnected(){return this.connectionState()===ue.Open}channel(e,t={config:{}}){this.isConnected()||this.connect();const r=new mt(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:s,ref:i}=e;let o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};if(this.log("push",`${t} ${r} (${i})`,s),this.isConnected())if(["broadcast","presence","postgres_changes"].includes(r)){if(this._throttle(o)())return"rate limited"}else o();else this.sendBuffer.push(o)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(K.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:cs}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:s,payload:i,ref:o}=t;(o&&o===this.pendingHeartbeatRef||s===(i==null?void 0:i.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${s} ${o&&"("+o+")"||""}`,i),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(s,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(K.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(hs,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_throttle(e,t=this.eventsPerSecondLimitMs){return()=>this.inThrottle?!0:(e(),t>0&&(this.inThrottle=!0,setTimeout(()=>{this.inThrottle=!1},t)),!1)}}class gt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function B(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class bs extends gt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Ht extends gt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var er=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?i(c.value):s(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})};const tr=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>er(void 0,void 0,void 0,function*(){return yield(yield qe(()=>Promise.resolve().then(()=>He),void 0,import.meta.url)).fetch(...t)}):e=fetch,(...t)=>e(...t)},ws=()=>er(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield qe(()=>Promise.resolve().then(()=>He),void 0,import.meta.url)).Response:Response});var be=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?i(c.value):s(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})};const Xe=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Ts=(n,e)=>be(void 0,void 0,void 0,function*(){const t=yield ws();n instanceof t?n.json().then(r=>{e(new bs(Xe(r),n.status||500))}).catch(r=>{e(new Ht(Xe(r),r))}):e(new Ht(Xe(n),n))}),Es=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};function Je(n,e,t,r,s,i){return be(this,void 0,void 0,function*(){return new Promise((o,a)=>{n(t,Es(e,r,s,i)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>Ts(l,a))})})}function lt(n,e,t,r){return be(this,void 0,void 0,function*(){return Je(n,"GET",e,t,r)})}function se(n,e,t,r,s){return be(this,void 0,void 0,function*(){return Je(n,"POST",e,r,s,t)})}function ks(n,e,t,r,s){return be(this,void 0,void 0,function*(){return Je(n,"PUT",e,r,s,t)})}function rr(n,e,t,r,s){return be(this,void 0,void 0,function*(){return Je(n,"DELETE",e,r,s,t)})}var z=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?i(c.value):s(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})};const Os={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Jt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Ss{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=tr(s)}uploadOrUpdate(e,t,r,s){return z(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},Jt),s),a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl)):(i=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType);const l=this._removeEmptyFolders(t),h=this._getFinalPath(l),c=yield this.fetch(`${this.url}/object/${h}`,Object.assign({method:e,body:i,headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return c.ok?{data:{path:l},error:null}:{data:null,error:yield c.json()}}catch(i){if(B(i))return{data:null,error:i};throw i}})}upload(e,t,r){return z(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return z(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let l;const h=Object.assign({upsert:Jt.upsert},s),c=Object.assign(Object.assign({},this.headers),{"x-upsert":String(h.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",h.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",h.cacheControl)):(l=r,c["cache-control"]=`max-age=${h.cacheControl}`,c["content-type"]=h.contentType);const d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:c});return d.ok?{data:{path:i},error:null}:{data:null,error:yield d.json()}}catch(l){if(B(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e){return z(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e);const r=yield se(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),s=new URL(this.url+r.url),i=s.searchParams.get("token");if(!i)throw new gt("No token returned by API");return{data:{signedUrl:s.toString(),path:e,token:i},error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}update(e,t,r){return z(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t){return z(this,void 0,void 0,function*(){try{return{data:yield se(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}copy(e,t){return z(this,void 0,void 0,function*(){try{return{data:{path:(yield se(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,r){return z(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield se(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(B(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return z(this,void 0,void 0,function*(){try{const s=yield se(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(B(s))return{data:null,error:s};throw s}})}download(e,t){return z(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield lt(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(B(a))return{data:null,error:a};throw a}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&s.push(l);let h=s.join("&");return h!==""&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${h}`)}}}remove(e){return z(this,void 0,void 0,function*(){try{return{data:yield rr(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}list(e,t,r){return z(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Os),t),{prefix:e||""});return{data:yield se(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(B(s))return{data:null,error:s};throw s}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const js="2.5.1",$s={"X-Client-Info":`storage-js/${js}`};var ge=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?i(c.value):s(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})};class As{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},$s),t),this.fetch=tr(r)}listBuckets(){return ge(this,void 0,void 0,function*(){try{return{data:yield lt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}getBucket(e){return ge(this,void 0,void 0,function*(){try{return{data:yield lt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ge(this,void 0,void 0,function*(){try{return{data:yield se(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return ge(this,void 0,void 0,function*(){try{return{data:yield ks(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}emptyBucket(e){return ge(this,void 0,void 0,function*(){try{return{data:yield se(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ge(this,void 0,void 0,function*(){try{return{data:yield rr(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}}class Ps extends As{constructor(e,t={},r){super(e,t,r)}from(e){return new Ss(this.url,this.headers,e,this.fetch)}}const Cs="2.22.0",Rs={"X-Client-Info":`supabase-js/${Cs}`};var xs=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?i(c.value):s(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})};const Is=n=>{let e;return n?e=n:typeof fetch>"u"?e=_t:e=fetch,(...t)=>e(...t)},Ds=()=>typeof Headers>"u"?vt.Headers:Headers,Us=(n,e,t)=>{const r=Is(t),s=Ds();return(i,o)=>xs(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:n;let h=new s(o==null?void 0:o.headers);return h.has("apikey")||h.set("apikey",n),h.has("Authorization")||h.set("Authorization",`Bearer ${l}`),r(i,Object.assign(Object.assign({},o),{headers:h}))})};function Ls(n){return n.replace(/\/$/,"")}function Fs(n,e){const{db:t,auth:r,realtime:s,global:i}=n,{db:o,auth:a,realtime:l,global:h}=e;return{db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},l),s),global:Object.assign(Object.assign({},h),i)}}var _e=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?i(c.value):s(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})};function Ns(n){return Math.round(Date.now()/1e3)+n}function Bs(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const re=()=>typeof document<"u",ce={tested:!1,writable:!1},Qe=()=>{if(!re())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ce.tested)return ce.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),ce.tested=!0,ce.writable=!0}catch{ce.tested=!0,ce.writable=!1}return ce.writable};function q(n,e){var t;e||(e=((t=window==null?void 0:window.location)===null||t===void 0?void 0:t.href)||""),n=n.replace(/[\[\]]/g,"\\$&");const r=new RegExp("[?&#]"+n+"(=([^&#]*)|&|#|$)"),s=r.exec(e);return s?s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):"":null}const sr=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>_e(void 0,void 0,void 0,function*(){return yield(yield qe(()=>Promise.resolve().then(()=>He),void 0,import.meta.url)).fetch(...t)}):e=fetch,(...t)=>e(...t)},Ms=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Se=(n,e,t)=>_e(void 0,void 0,void 0,function*(){yield n.setItem(e,JSON.stringify(t))}),Ue=(n,e)=>_e(void 0,void 0,void 0,function*(){const t=yield n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}}),Ye=(n,e)=>_e(void 0,void 0,void 0,function*(){yield n.removeItem(e)});function qs(n){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",r,s,i,o,a,l,h,c=0;for(n=n.replace("-","+").replace("_","/");c<n.length;)o=e.indexOf(n.charAt(c++)),a=e.indexOf(n.charAt(c++)),l=e.indexOf(n.charAt(c++)),h=e.indexOf(n.charAt(c++)),r=o<<2|a>>4,s=(a&15)<<4|l>>2,i=(l&3)<<6|h,t=t+String.fromCharCode(r),l!=64&&s!=0&&(t=t+String.fromCharCode(s)),h!=64&&i!=0&&(t=t+String.fromCharCode(i));return t}class ze{constructor(){this.promise=new ze.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}ze.promiseConstructor=Promise;function zt(n){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=n.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(qs(r))}function Hs(n){return new Promise(e=>{setTimeout(()=>e(null),n)})}function Js(n,e){return new Promise((r,s)=>{_e(this,void 0,void 0,function*(){for(let i=0;i<1/0;i++)try{const o=yield n(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){s(o);return}}})})}function zs(n){return("0"+n.toString(16)).substr(-2)}function Le(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,zs).join("")}function Gs(n){return _e(this,void 0,void 0,function*(){const t=new TextEncoder().encode(n),r=yield crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")})}function Vs(n){return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function Fe(n){return _e(this,void 0,void 0,function*(){if(typeof crypto>"u")return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const e=yield Gs(n);return Vs(e)})}class yt extends Error{constructor(e,t){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t}}function k(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class Ks extends yt{constructor(e,t){super(e,t),this.name="AuthApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}function Ws(n){return k(n)&&n.name==="AuthApiError"}class ir extends yt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Re extends yt{constructor(e,t,r){super(e),this.name=t,this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class je extends Re{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class Ne extends Re{constructor(e){super(e,"AuthInvalidCredentialsError",400)}}class Z extends Re{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ze extends Re{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ct extends Re{constructor(e,t){super(e,"AuthRetryableFetchError",t)}}var bt=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?i(c.value):s(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})},Xs=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const Be=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Qs=(n,e)=>bt(void 0,void 0,void 0,function*(){const t=[502,503,504];Ms(n)?t.includes(n.status)?e(new ct(Be(n),n.status)):n.json().then(r=>{e(new Ks(Be(r),n.status||500))}).catch(r=>{e(new ir(Be(r),r))}):e(new ct(Be(n),0))}),Ys=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};function O(n,e,t,r){var s;return bt(this,void 0,void 0,function*(){const i=Object.assign({},r==null?void 0:r.headers);r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=yield Zs(n,e,t+a,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}})}function Zs(n,e,t,r,s,i){return bt(this,void 0,void 0,function*(){return new Promise((o,a)=>{n(t,Ys(e,r,s,i)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>Qs(l,a))})})}function te(n){var e;let t=null;si(n)&&(t=Object.assign({},n),t.expires_at=Ns(n.expires_in));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function de(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function ei(n){return{data:n,error:null}}function ti(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i}=n,o=Xs(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function ri(n){return n}function si(n){return n.access_token&&n.refresh_token&&n.expires_in}var Q=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?i(c.value):s(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})},ii=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class ni{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=sr(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(e){return Q(this,void 0,void 0,function*(){try{return yield O(this.fetch,"POST",`${this.url}/logout`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(t){if(k(t))return{data:null,error:t};throw t}})}inviteUserByEmail(e,t={}){return Q(this,void 0,void 0,function*(){try{return yield O(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:de})}catch(r){if(k(r))return{data:{user:null},error:r};throw r}})}generateLink(e){return Q(this,void 0,void 0,function*(){try{const{options:t}=e,r=ii(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),yield O(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:ti,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(k(t))return{data:{properties:null,user:null},error:t};throw t}})}createUser(e){return Q(this,void 0,void 0,function*(){try{return yield O(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:de})}catch(t){if(k(t))return{data:{user:null},error:t};throw t}})}listUsers(e){var t,r,s,i,o,a,l;return Q(this,void 0,void 0,function*(){try{const h={nextPage:null,lastPage:0,total:0},c=yield O(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:ri});if(c.error)throw c.error;const d=yield c.json(),p=(o=c.headers.get("x-total-count"))!==null&&o!==void 0?o:0,v=(l=(a=c.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return v.length>0&&(v.forEach(m=>{const w=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(m.split(";")[1].split("=")[1]);h[`${_}Page`]=w}),h.total=parseInt(p)),{data:Object.assign(Object.assign({},d),h),error:null}}catch(h){if(k(h))return{data:{users:[]},error:h};throw h}})}getUserById(e){return Q(this,void 0,void 0,function*(){try{return yield O(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:de})}catch(t){if(k(t))return{data:{user:null},error:t};throw t}})}updateUserById(e,t){return Q(this,void 0,void 0,function*(){try{return yield O(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:de})}catch(r){if(k(r))return{data:{user:null},error:r};throw r}})}deleteUser(e,t=!1){return Q(this,void 0,void 0,function*(){try{return yield O(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:de})}catch(r){if(k(r))return{data:{user:null},error:r};throw r}})}_listFactors(e){return Q(this,void 0,void 0,function*(){try{const{data:t,error:r}=yield O(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(k(t))return{data:null,error:t};throw t}})}_deleteFactor(e){return Q(this,void 0,void 0,function*(){try{return{data:yield O(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(k(t))return{data:null,error:t};throw t}})}}const oi="2.27.0",ai="http://localhost:9999",li="supabase.auth.token",ci={"X-Client-Info":`gotrue-js/${oi}`},hi=10,ui={getItem:n=>Qe()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{Qe()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{Qe()&&globalThis.localStorage.removeItem(n)}};function di(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}var g=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?i(c.value):s(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})};di();const fi={url:ai,storageKey:li,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ci,flowType:"implicit"},et=30*1e3,pi=3;class vi{constructor(e){var t;this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.broadcastChannel=null;const r=Object.assign(Object.assign({},fi),e);if(this.inMemorySession=null,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.persistSession=r.persistSession,this.storage=r.storage||ui,this.admin=new ni({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=sr(r.fetch),this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},re()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(t=this.broadcastChannel)===null||t===void 0||t.addEventListener("message",s=>{this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}initialize(){return this.initializePromise||(this.initializePromise=this._initialize()),this.initializePromise}_initialize(){return g(this,void 0,void 0,function*(){if(this.initializePromise)return this.initializePromise;try{const e=yield this._isPKCEFlow();if(this.detectSessionInUrl&&this._isImplicitGrantFlow()||e){const{data:t,error:r}=yield this._getSessionFromUrl(e);if(r)return yield this._removeSession(),{error:r};const{session:s,redirectType:i}=t;return yield this._saveSession(s),setTimeout(()=>{i==="recovery"?this._notifyAllSubscribers("PASSWORD_RECOVERY",s):this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(e){return k(e)?{error:e}:{error:new ir("Unexpected error during initialization",e)}}finally{yield this._handleVisibilityChange()}})}signUp(e){var t,r,s;return g(this,void 0,void 0,function*(){try{yield this._removeSession();let i;if("email"in e){const{email:c,password:d,options:p}=e;let v=null,m=null;if(this.flowType==="pkce"){const w=Le();yield Se(this.storage,`${this.storageKey}-code-verifier`,w),v=yield Fe(w),m=w===v?"plain":"s256"}i=yield O(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:p==null?void 0:p.emailRedirectTo,body:{email:c,password:d,data:(t=p==null?void 0:p.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},code_challenge:v,code_challenge_method:m},xform:te})}else if("phone"in e){const{phone:c,password:d,options:p}=e;i=yield O(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:c,password:d,data:(r=p==null?void 0:p.data)!==null&&r!==void 0?r:{},channel:(s=p==null?void 0:p.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken}},xform:te})}else throw new Ne("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,h=o.user;return o.session&&(yield this._saveSession(o.session),this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:h,session:l},error:null}}catch(i){if(k(i))return{data:{user:null,session:null},error:i};throw i}})}signInWithPassword(e){return g(this,void 0,void 0,function*(){try{yield this._removeSession();let t;if("email"in e){const{email:i,password:o,options:a}=e;t=yield O(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:te})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=yield O(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:te})}else throw new Ne("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s||!r?{data:{user:null,session:null},error:s}:(r.session&&(yield this._saveSession(r.session),this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:r,error:s})}catch(t){if(k(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOAuth(e){var t,r,s,i;return g(this,void 0,void 0,function*(){return yield this._removeSession(),yield this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})})}exchangeCodeForSession(e){return g(this,void 0,void 0,function*(){const t=yield Ue(this.storage,`${this.storageKey}-code-verifier`),{data:r,error:s}=yield O(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:t},xform:te});return yield Ye(this.storage,`${this.storageKey}-code-verifier`),s||!r?{data:{user:null,session:null},error:s}:(r.session&&(yield this._saveSession(r.session),this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:r,error:s})})}signInWithIdToken(e){return g(this,void 0,void 0,function*(){yield this._removeSession();try{const{options:t,provider:r,token:s,nonce:i}=e,o=yield O(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,nonce:i,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:te}),{data:a,error:l}=o;return l||!a?{data:{user:null,session:null},error:l}:(a.session&&(yield this._saveSession(a.session),this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:l})}catch(t){if(k(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOtp(e){var t,r,s,i,o;return g(this,void 0,void 0,function*(){try{if(yield this._removeSession(),"email"in e){const{email:a,options:l}=e;let h=null,c=null;if(this.flowType==="pkce"){const p=Le();yield Se(this.storage,`${this.storageKey}-code-verifier`,p),h=yield Fe(p),c=p===h?"plain":"s256"}const{error:d}=yield O(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:h,code_challenge_method:c},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:l}=e,{error:h}=yield O(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null},error:h}}throw new Ne("You must provide either an email or phone number.")}catch(a){if(k(a))return{data:{user:null,session:null},error:a};throw a}})}verifyOtp(e){var t,r;return g(this,void 0,void 0,function*(){try{yield this._removeSession();const{data:s,error:i}=yield O(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:(t=e.options)===null||t===void 0?void 0:t.captchaToken}}),redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,xform:te});if(i)throw i;if(!s)throw new Error("An error occurred on token verification.");const o=s.session,a=s.user;return o!=null&&o.access_token&&(yield this._saveSession(o),this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:a,session:o},error:null}}catch(s){if(k(s))return{data:{user:null,session:null},error:s};throw s}})}signInWithSSO(e){var t,r,s;return g(this,void 0,void 0,function*(){try{return yield this._removeSession(),yield O(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0}),headers:this.headers,xform:ei})}catch(i){if(k(i))return{data:null,error:i};throw i}})}resend(e){return g(this,void 0,void 0,function*(){try{yield this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:o}=yield O(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:s,options:i}=e,{error:o}=yield O(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null},error:o}}throw new Ne("You must provide either an email or phone number and a type")}catch(t){if(k(t))return{data:{user:null,session:null},error:t};throw t}})}getSession(){return g(this,void 0,void 0,function*(){yield this.initializePromise;let e=null;if(this.persistSession){const i=yield Ue(this.storage,this.storageKey);i!==null&&(this._isValidSession(i)?e=i:yield this._removeSession())}else e=this.inMemorySession;if(!e)return{data:{session:null},error:null};if(!(e.expires_at?e.expires_at<=Date.now()/1e3:!1))return{data:{session:e},error:null};const{session:r,error:s}=yield this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:r},error:null}})}getUser(e){var t,r;return g(this,void 0,void 0,function*(){try{if(!e){const{data:s,error:i}=yield this.getSession();if(i)throw i;e=(r=(t=s.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:void 0}return yield O(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:de})}catch(s){if(k(s))return{data:{user:null},error:s};throw s}})}updateUser(e,t={}){return g(this,void 0,void 0,function*(){try{const{data:r,error:s}=yield this.getSession();if(s)throw s;if(!r.session)throw new je;const i=r.session,{data:o,error:a}=yield O(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:e,jwt:i.access_token,xform:de});if(a)throw a;return i.user=o.user,yield this._saveSession(i),this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}}catch(r){if(k(r))return{data:{user:null},error:r};throw r}})}_decodeJWT(e){return zt(e)}setSession(e){return g(this,void 0,void 0,function*(){try{if(!e.access_token||!e.refresh_token)throw new je;const t=Date.now()/1e3;let r=t,s=!0,i=null;const o=zt(e.access_token);if(o.exp&&(r=o.exp,s=r<=t),s){const{session:a,error:l}=yield this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=yield this.getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},yield this._saveSession(i),this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(k(t))return{data:{session:null,user:null},error:t};throw t}})}refreshSession(e){var t;return g(this,void 0,void 0,function*(){try{if(!e){const{data:i,error:o}=yield this.getSession();if(o)throw o;e=(t=i.session)!==null&&t!==void 0?t:void 0}if(!(e!=null&&e.refresh_token))throw new je;const{session:r,error:s}=yield this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}}catch(r){if(k(r))return{data:{user:null,session:null},error:r};throw r}})}_getSessionFromUrl(e){return g(this,void 0,void 0,function*(){try{if(!re())throw new Z("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new Z("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new Ze("Not a valid PKCE flow url.");if(e){const _=q("code");if(!_)throw new Ze("No code detected.");const{data:T,error:F}=yield this.exchangeCodeForSession(_);if(F)throw F;if(!T.session)throw new Ze("No session detected.");let I=new URL(window.location.href);return I.searchParams.delete("code"),window.history.replaceState(window.history.state,"",I.toString()),{data:{session:T.session,redirectType:null},error:null}}const t=q("error_description");if(t){const _=q("error_code");if(!_)throw new Z("No error_code detected.");const T=q("error");throw T?new Z(t,{error:T,code:_}):new Z("No error detected.")}const r=q("provider_token"),s=q("provider_refresh_token"),i=q("access_token");if(!i)throw new Z("No access_token detected.");const o=q("expires_in");if(!o)throw new Z("No expires_in detected.");const a=q("refresh_token");if(!a)throw new Z("No refresh_token detected.");const l=q("token_type");if(!l)throw new Z("No token_type detected.");const c=Math.round(Date.now()/1e3)+parseInt(o),{data:d,error:p}=yield this.getUser(i);if(p)throw p;const v=d.user,m={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:parseInt(o),expires_at:c,refresh_token:a,token_type:l,user:v},w=q("type");return window.location.hash="",{data:{session:m,redirectType:w},error:null}}catch(t){if(k(t))return{data:{session:null,redirectType:null},error:t};throw t}})}_isImplicitGrantFlow(){return re()&&(!!q("access_token")||!!q("error_description"))}_isPKCEFlow(){return g(this,void 0,void 0,function*(){const e=yield Ue(this.storage,`${this.storageKey}-code-verifier`);return re()&&!!q("code")&&!!e})}signOut(){var e;return g(this,void 0,void 0,function*(){const{data:t,error:r}=yield this.getSession();if(r)return{error:r};const s=(e=t.session)===null||e===void 0?void 0:e.access_token;if(s){const{error:i}=yield this.admin.signOut(s);if(i&&!(Ws(i)&&(i.status===404||i.status===401)))return{error:i}}return yield this._removeSession(),yield Ye(this.storage,`${this.storageKey}-code-verifier`),this._notifyAllSubscribers("SIGNED_OUT",null),{error:null}})}onAuthStateChange(e){const t=Bs(),r={id:t,callback:e,unsubscribe:()=>{this.stateChangeEmitters.delete(t)}};return this.stateChangeEmitters.set(t,r),this.emitInitialSession(t),{data:{subscription:r}}}emitInitialSession(e){var t,r;return g(this,void 0,void 0,function*(){try{const{data:{session:s},error:i}=yield this.getSession();if(i)throw i;(t=this.stateChangeEmitters.get(e))===null||t===void 0||t.callback("INITIAL_SESSION",s)}catch(s){(r=this.stateChangeEmitters.get(e))===null||r===void 0||r.callback("INITIAL_SESSION",null),console.error(s)}})}resetPasswordForEmail(e,t={}){return g(this,void 0,void 0,function*(){let r=null,s=null;if(this.flowType==="pkce"){const i=Le();yield Se(this.storage,`${this.storageKey}-code-verifier`,i),r=yield Fe(i),s=i===r?"plain":"s256"}try{return yield O(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(k(i))return{data:null,error:i};throw i}})}_refreshAccessToken(e){return g(this,void 0,void 0,function*(){try{const t=Date.now();return yield Js(r=>g(this,void 0,void 0,function*(){return yield Hs(r*200),yield O(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:te})}),(r,s,i)=>i&&i.error&&i.error instanceof ct&&Date.now()+(r+1)*200-t<et)}catch(t){if(k(t))return{data:{session:null,user:null},error:t};throw t}})}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){return g(this,void 0,void 0,function*(){const r=yield this._getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return re()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}})}_recoverAndRefresh(){var e;return g(this,void 0,void 0,function*(){try{const t=yield Ue(this.storage,this.storageKey);if(!this._isValidSession(t)){t!==null&&(yield this._removeSession());return}const r=Math.round(Date.now()/1e3);if(((e=t.expires_at)!==null&&e!==void 0?e:1/0)<r+hi){if(this.autoRefreshToken&&t.refresh_token){const{error:s}=yield this._callRefreshToken(t.refresh_token);s&&(console.log(s.message),yield this._removeSession())}}else this.persistSession&&(yield this._saveSession(t)),this._notifyAllSubscribers("SIGNED_IN",t)}catch(t){console.error(t);return}})}_callRefreshToken(e){var t,r;return g(this,void 0,void 0,function*(){if(this.refreshingDeferred)return this.refreshingDeferred.promise;try{if(this.refreshingDeferred=new ze,!e)throw new je;const{data:s,error:i}=yield this._refreshAccessToken(e);if(i)throw i;if(!s.session)throw new je;yield this._saveSession(s.session),this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const o={session:s.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(s){if(k(s)){const i={session:null,error:s};return(t=this.refreshingDeferred)===null||t===void 0||t.resolve(i),i}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(s),s}finally{this.refreshingDeferred=null}})}_notifyAllSubscribers(e,t,r=!0){this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t}),this.stateChangeEmitters.forEach(s=>s.callback(e,t))}_saveSession(e){return g(this,void 0,void 0,function*(){this.persistSession||(this.inMemorySession=e),this.persistSession&&e.expires_at&&(yield this._persistSession(e))})}_persistSession(e){return Se(this.storage,this.storageKey,e)}_removeSession(){return g(this,void 0,void 0,function*(){this.persistSession?yield Ye(this.storage,this.storageKey):this.inMemorySession=null})}_removeVisibilityChangedCallback(){const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&re()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){return g(this,void 0,void 0,function*(){yield this._stopAutoRefresh();const e=setInterval(()=>this._autoRefreshTokenTick(),et);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),yield this._autoRefreshTokenTick()})}_stopAutoRefresh(){return g(this,void 0,void 0,function*(){const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)})}startAutoRefresh(){return g(this,void 0,void 0,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return g(this,void 0,void 0,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return g(this,void 0,void 0,function*(){const e=Date.now();try{const{data:{session:t}}=yield this.getSession();if(!t||!t.refresh_token||!t.expires_at)return;Math.floor((t.expires_at*1e3-e)/et)<pi&&(yield this._callRefreshToken(t.refresh_token))}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}})}_handleVisibilityChange(){return g(this,void 0,void 0,function*(){if(!re()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>g(this,void 0,void 0,function*(){return yield this._onVisibilityChanged(!1)}),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}})}_onVisibilityChanged(e){return g(this,void 0,void 0,function*(){document.visibilityState==="visible"?(e||(yield this.initializePromise,yield this._recoverAndRefresh()),this.autoRefreshToken&&this._startAutoRefresh()):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(e,t){return g(this,void 0,void 0,function*(){const r=[`provider=${encodeURIComponent(e)}`];if(t!=null&&t.redirectTo&&r.push(`redirect_to=${encodeURIComponent(t.redirectTo)}`),t!=null&&t.scopes&&r.push(`scopes=${encodeURIComponent(t.scopes)}`),this.flowType==="pkce"){const s=Le();yield Se(this.storage,`${this.storageKey}-code-verifier`,s);const i=yield Fe(s),o=s===i?"plain":"s256",a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});r.push(a.toString())}if(t!=null&&t.queryParams){const s=new URLSearchParams(t.queryParams);r.push(s.toString())}return`${this.url}/authorize?${r.join("&")}`})}_unenroll(e){var t;return g(this,void 0,void 0,function*(){try{const{data:r,error:s}=yield this.getSession();return s?{data:null,error:s}:yield O(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token})}catch(r){if(k(r))return{data:null,error:r};throw r}})}_enroll(e){var t,r;return g(this,void 0,void 0,function*(){try{const{data:s,error:i}=yield this.getSession();if(i)return{data:null,error:i};const{data:o,error:a}=yield O(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(t=s==null?void 0:s.session)===null||t===void 0?void 0:t.access_token});return a?{data:null,error:a}:(!((r=o==null?void 0:o.totp)===null||r===void 0)&&r.qr_code&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})}catch(s){if(k(s))return{data:null,error:s};throw s}})}_verify(e){var t;return g(this,void 0,void 0,function*(){try{const{data:r,error:s}=yield this.getSession();if(s)return{data:null,error:s};const{data:i,error:o}=yield O(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token});return o?{data:null,error:o}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:o})}catch(r){if(k(r))return{data:null,error:r};throw r}})}_challenge(e){var t;return g(this,void 0,void 0,function*(){try{const{data:r,error:s}=yield this.getSession();return s?{data:null,error:s}:yield O(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token})}catch(r){if(k(r))return{data:null,error:r};throw r}})}_challengeAndVerify(e){return g(this,void 0,void 0,function*(){const{data:t,error:r}=yield this._challenge({factorId:e.factorId});return r?{data:null,error:r}:yield this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})})}_listFactors(){return g(this,void 0,void 0,function*(){const{data:{user:e},error:t}=yield this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],s=r.filter(i=>i.factor_type==="totp"&&i.status==="verified");return{data:{all:r,totp:s},error:null}})}_getAuthenticatorAssuranceLevel(){var e,t;return g(this,void 0,void 0,function*(){const{data:{session:r},error:s}=yield this.getSession();if(s)return{data:null,error:s};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const i=this._decodeJWT(r.access_token);let o=null;i.aal&&(o=i.aal);let a=o;((t=(e=r.user.factors)===null||e===void 0?void 0:e.filter(c=>c.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(a="aal2");const h=i.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:h},error:null}})}}class _i extends vi{constructor(e){super(e)}}var mi=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?i(c.value):s(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})};const gi={headers:Rs},yi={schema:"public"},bi={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},wi={};class Ti{constructor(e,t,r){var s,i,o,a,l,h,c,d;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const p=Ls(e);if(this.realtimeUrl=`${p}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${p}/auth/v1`,this.storageUrl=`${p}/storage/v1`,p.match(/(supabase\.co)|(supabase\.in)/)){const T=p.split(".");this.functionsUrl=`${T[0]}.functions.${T[1]}.${T[2]}`}else this.functionsUrl=`${p}/functions/v1`;const m=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,w={db:yi,realtime:wi,auth:Object.assign(Object.assign({},bi),{storageKey:m}),global:gi},_=Fs(r??{},w);this.storageKey=(i=(s=_.auth)===null||s===void 0?void 0:s.storageKey)!==null&&i!==void 0?i:"",this.headers=(a=(o=_.global)===null||o===void 0?void 0:o.headers)!==null&&a!==void 0?a:{},this.auth=this._initSupabaseAuthClient((l=_.auth)!==null&&l!==void 0?l:{},this.headers,(h=_.global)===null||h===void 0?void 0:h.fetch),this.fetch=Us(t,this._getAccessToken.bind(this),(c=_.global)===null||c===void 0?void 0:c.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},_.realtime)),this.rest=new Fr(`${p}/rest/v1`,{headers:this.headers,schema:(d=_.db)===null||d===void 0?void 0:d.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new Pr(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Ps(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}rpc(e,t={},r){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return mi(this,void 0,void 0,function*(){const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:i,flowType:o},a,l){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new _i({url:this.authUrl,headers:Object.assign(Object.assign({},h),a),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:o,fetch:l})}_initRealtimeClient(e){return new ys(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,r==null?void 0:r.access_token,"CLIENT")})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==t?(this.realtime.setAuth(t??null),this.changedAccessToken=t):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Ei=(n,e,t)=>new Ti(n,e,t),wt=2,Ge=Ei("https://supaapi.byteforce.ro/","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJzZXJ2aWNlX3JvbGUiLAogICAgImlzcyI6ICJzdXBhYmFzZS1kZW1vIiwKICAgICJpYXQiOiAxNjQxNzY5MjAwLAogICAgImV4cCI6IDE3OTk1MzU2MDAKfQ.DaYlNEoUrrEn2Ig7tqibS-PHK5vgusbcbo7X36XVt4Q"),Tt=ft({});function ki(){const{subscribe:n,set:e,update:t}=ft({});return{subscribe:n,setDB:s=>e(s),set:async s=>{const{data:i,error:o}=await Ge.from("sensor_realtime").update(s).eq("id",wt);if(o){console.error("Error updating data:",o.message);return}console.log(i)},reset:()=>e({})}}const Pe=ki();try{(async()=>{const{data:n,error:e}=await Ge.from("sensor_realtime").select("*").eq("id",wt);if(e)throw e;console.log(n),n&&(Tt.set(n[0]),Pe.setDB({fan:n[0].fan,geam:n[0].geam}))})()}catch(n){console.log(n)}(async()=>{try{const n="HUMIDITY_percent",e="2023-05-12 14:35:38.301766+00",t="2023-05-12 10:48:42.09073+00",r="sensors_arch";let{data:s,error:i}=await Ge.rpc("get_median_value",{column_name:n,end_time:e,start_time:t,table_name:r});console.log(s)}catch{}})();Ge.channel("sensor_realtime").on("postgres_changes",{event:"UPDATE",schema:"public"},n=>{n.new.id===wt&&(console.log(n.new),Tt.set(n.new),Pe.setDB({fan:n.new.fan,geam:n.new.geam}))}).subscribe();function Gt(n,e,t){const r=n.slice();return r[5]=e[t][0],r[6]=e[t][1],r}function Oi(n){let e,t;return{c(){e=R("p"),t=W("Loading...")},l(r){e=x(r,"P",{});var s=C(e);t=X(s,"Loading..."),s.forEach(S)},m(r,s){ve(r,e,s),b(e,t)},p:pe,i:pe,o:pe,d(r){r&&S(e)}}}function Si(n){let e,t,r=Object.entries(n[0]),s=[];for(let o=0;o<r.length;o+=1)s[o]=Vt(Gt(n,r,o));const i=o=>fe(s[o],1,1,()=>{s[o]=null});return{c(){e=R("div");for(let o=0;o<s.length;o+=1)s[o].c();this.h()},l(o){e=x(o,"DIV",{class:!0});var a=C(e);for(let l=0;l<s.length;l+=1)s[l].l(a);a.forEach(S),this.h()},h(){j(e,"class","items svelte-j39u7j")},m(o,a){ve(o,e,a);for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(e,null);t=!0},p(o,a){if(a&1){r=Object.entries(o[0]);let l;for(l=0;l<r.length;l+=1){const h=Gt(o,r,l);s[l]?(s[l].p(h,a),ie(s[l],1)):(s[l]=Vt(h),s[l].c(),ie(s[l],1),s[l].m(e,null))}for(Wt(),l=r.length;l<s.length;l+=1)i(l);Kt()}},i(o){if(!t){for(let a=0;a<r.length;a+=1)ie(s[a]);t=!0}},o(o){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)fe(s[a]);t=!1},d(o){o&&S(e),hr(s,o)}}}function Vt(n){let e,t;return e=new yr({props:{name:n[5],value:n[6]}}),{c(){tt(e.$$.fragment)},l(r){rt(e.$$.fragment,r)},m(r,s){st(e,r,s),t=!0},p(r,s){const i={};s&1&&(i.name=r[5]),s&1&&(i.value=r[6]),e.$set(i)},i(r){t||(ie(e.$$.fragment,r),t=!0)},o(r){fe(e.$$.fragment,r),t=!1},d(r){it(e,r)}}}function ji(n){let e,t,r,s,i,o,a,l,h,c,d,p,v,m,w,_,T,F,I,A,H,we,Te,N,Ee,ke,L,ne,oe,u,f,y,D;const U=[Si,Oi],E=[];function ae(P,M){return P[0]!=0?0:1}_=ae(n),T=E[_]=U[_](n);function le(P){n[2](P)}let me={};n[1].geam!==void 0&&(me.checked=n[1].geam),N=new Dt({props:me}),Pt.push(()=>Ct(N,"checked",le));function nr(P){n[3](P)}let Et={};return n[1].fan!==void 0&&(Et.checked=n[1].fan),f=new Dt({props:Et}),Pt.push(()=>Ct(f,"checked",nr)),{c(){e=R("div"),t=R("div"),r=Rt("svg"),s=Rt("path"),i=G(),o=R("div"),a=R("h1"),l=W("aqi"),h=G(),c=R("h1"),d=W("169"),p=G(),v=R("h1"),m=W("unhealthy"),w=G(),T.c(),F=G(),I=R("div"),A=R("div"),H=R("p"),we=W("Geam"),Te=G(),tt(N.$$.fragment),ke=G(),L=R("div"),ne=R("p"),oe=W("Fan"),u=G(),tt(f.$$.fragment),this.h()},l(P){e=x(P,"DIV",{class:!0});var M=C(e);t=x(M,"DIV",{class:!0});var ee=C(t);r=xt(ee,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0});var Oe=C(r);s=xt(Oe,"path",{"fill-rule":!0,"clip-rule":!0,d:!0,fill:!0}),C(s).forEach(S),Oe.forEach(S),i=V(ee),o=x(ee,"DIV",{class:!0});var Y=C(o);a=x(Y,"H1",{class:!0});var kt=C(a);l=X(kt,"aqi"),kt.forEach(S),h=V(Y),c=x(Y,"H1",{class:!0});var Ot=C(c);d=X(Ot,"169"),Ot.forEach(S),p=V(Y),v=x(Y,"H1",{class:!0});var St=C(v);m=X(St,"unhealthy"),St.forEach(S),Y.forEach(S),ee.forEach(S),w=V(M),T.l(M),F=V(M),I=x(M,"DIV",{class:!0});var xe=C(I);A=x(xe,"DIV",{class:!0});var Ie=C(A);H=x(Ie,"P",{});var jt=C(H);we=X(jt,"Geam"),jt.forEach(S),Te=V(Ie),rt(N.$$.fragment,Ie),Ie.forEach(S),ke=V(xe),L=x(xe,"DIV",{class:!0});var De=C(L);ne=x(De,"P",{});var $t=C(ne);oe=X($t,"Fan"),$t.forEach(S),u=V(De),rt(f.$$.fragment,De),De.forEach(S),xe.forEach(S),M.forEach(S),this.h()},h(){j(s,"fill-rule","evenodd"),j(s,"clip-rule","evenodd"),j(s,"d","M270.917 163.673C265.65 190.151 252.65 214.473 233.56 233.563L229.951 229.954C249.619 207.988 261.571 179.022 261.571 147.276C261.571 78.6402 205.702 22.9999 136.785 22.9999C67.8682 22.9999 11.9999 78.6402 11.9999 147.276C11.9999 179.152 24.0498 208.224 43.8604 230.223L40.52 233.563C21.4302 214.473 8.42982 190.151 3.16294 163.673C-2.10394 137.194 0.599213 109.749 10.9306 84.8067C21.2619 59.8645 38.7575 38.5462 61.2048 23.5474C83.6521 8.54855 110.043 0.542969 137.04 0.542969C164.037 0.542969 190.428 8.54855 212.875 23.5474C235.323 38.5462 252.818 59.8645 263.15 84.8066C273.481 109.749 276.184 137.194 270.917 163.673Z"),j(s,"fill","#FF715B"),j(r,"width","274"),j(r,"height","234"),j(r,"viewBox","0 0 274 234"),j(r,"fill","none"),j(r,"xmlns","http://www.w3.org/2000/svg"),j(a,"class","aqi svelte-j39u7j"),j(c,"class","value svelte-j39u7j"),j(v,"class","sms svelte-j39u7j"),j(o,"class","text svelte-j39u7j"),j(t,"class","circle svelte-j39u7j"),j(A,"class","button svelte-j39u7j"),j(L,"class","button svelte-j39u7j"),j(I,"class","buttons svelte-j39u7j"),j(e,"class","container svelte-j39u7j")},m(P,M){ve(P,e,M),b(e,t),b(t,r),b(r,s),b(t,i),b(t,o),b(o,a),b(a,l),b(o,h),b(o,c),b(c,d),b(o,p),b(o,v),b(v,m),b(e,w),E[_].m(e,null),b(e,F),b(e,I),b(I,A),b(A,H),b(H,we),b(A,Te),st(N,A,null),b(I,ke),b(I,L),b(L,ne),b(ne,oe),b(L,u),st(f,L,null),D=!0},p(P,[M]){let ee=_;_=ae(P),_===ee?E[_].p(P,M):(Wt(),fe(E[ee],1,1,()=>{E[ee]=null}),Kt(),T=E[_],T?T.p(P,M):(T=E[_]=U[_](P),T.c()),ie(T,1),T.m(e,F));const Oe={};!Ee&&M&2&&(Ee=!0,Oe.checked=P[1].geam,It(()=>Ee=!1)),N.$set(Oe);const Y={};!y&&M&2&&(y=!0,Y.checked=P[1].fan,It(()=>y=!1)),f.$set(Y)},i(P){D||(ie(T),ie(N.$$.fragment,P),ie(f.$$.fragment,P),D=!0)},o(P){fe(T),fe(N.$$.fragment,P),fe(f.$$.fragment,P),D=!1},d(P){P&&S(e),E[_].d(),it(N),it(f)}}}function $i(n,e,t){let r;ar(n,Pe,l=>t(1,r=l));let{data:s=0}=e,i;lr(()=>(i=Tt.subscribe(l=>{var c;let h=l;t(0,s={"Carbon Dioxide":{value:h.CO2_ppm,unit:"ppm"},Temperature:{value:h.average_TEMP_celsius,unit:"°C"},Humidity:{value:h.HUMIDITY_percent,unit:"%"},Pressure:{value:(c=h.PRESSURE_pascals)==null?void 0:c.toFixed(0),unit:"Pa"},TVOC:{value:h.TVOC_ppb,unit:"ppb"}})}),i)),cr(()=>{t(0,s=0)});function o(l){n.$$.not_equal(r.geam,l)&&(r.geam=l,Pe.set(r))}function a(l){n.$$.not_equal(r.fan,l)&&(r.fan=l,Pe.set(r))}return n.$$set=l=>{"data"in l&&t(0,s=l.data)},[s,r,o,a]}class xi extends ht{constructor(e){super(),ut(this,e,$i,ji,dt,{data:0})}}export{xi as component};
